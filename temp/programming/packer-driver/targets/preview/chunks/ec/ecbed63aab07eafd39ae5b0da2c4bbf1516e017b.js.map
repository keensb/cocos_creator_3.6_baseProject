{"version":3,"sources":["file:///F:/creator/project_3/NewProject_36/assets/script/overwrite/engineOverride.ts"],"names":["engineOverrider","BaseNode","director","Node","NodeEventType","UIOpacity","UITransform","startWrite","prototype","getOrAddComponent","componentType","getComponent","args","addComponent","call","Object","defineProperty","get","parent","getScene","enumerable","configurable","_setParent","setParent","value","keepWorldTransform","oldStage","stage","loopHandler","node","evtType","children","length","i","emit","newStage","STAGE_CHANGED","opacity","set","width","height","position","x","setPosition","y","z","scale","setScale"],"mappings":"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","sourcesContent":["\r\nimport { BaseNode, Component, director, Node, NodeEventType, UIOpacity, UITransform } from 'cc';\r\n\r\n\r\nclass engineOverrider {\r\n\r\n    public static startWrite() {\r\n        //新增API, 建议把API写进 or.d.ts 下的 interface BaseNode 中,便于在使用时带自动提示功能 \r\n\r\n        //检测BaseNode之下有没有这个Component, 有的话直接返回Component的引用; 没有的话自动新增Component实例再返回其引用\r\n        BaseNode.prototype.getOrAddComponent = function <T extends Component>(componentType: new (...parmas) => T, ...args): T {\r\n            if (!this.getComponent(componentType)) {\r\n                return this.addComponent.call(this, componentType, ...args);\r\n            }\r\n            return this.getComponent(componentType);\r\n        }\r\n\r\n        Object.defineProperty(BaseNode.prototype, \"stage\", {\r\n            get: function () {\r\n                let parent = this.parent;\r\n                while (parent) {\r\n                    if (parent == director.getScene()) {\r\n                        break;\r\n                    }\r\n                    parent = parent.parent;\r\n                }\r\n                return parent;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n\r\n        const _setParent = BaseNode.prototype.setParent;\r\n        BaseNode.prototype.setParent = function setParent(value, keepWorldTransform) {\r\n            //不能用 if(this.scene)来判断是否在场景上 this.scene 不会随着节点的 加载/移除 发生改变\r\n\r\n            let oldStage = this.stage;\r\n            \r\n            const loopHandler = function (node: BaseNode, evtType: string) {\r\n                if (node && node.children && node.children.length > 0) {\r\n                    for (let i = 0; i < node.children.length; i++) {\r\n                        if (!node.children[i].emit)\r\n                            continue;\r\n                        node.children[i].emit(evtType);\r\n                        loopHandler(node[i], evtType);\r\n                    }\r\n                }\r\n            }\r\n\r\n            _setParent.call(this, value, keepWorldTransform);\r\n\r\n            let newStage = this.stage;\r\n\r\n            if (oldStage != newStage) {//场景发生了变化 有可能换了新场景 也有可能被加入场景成为可视节点  也有可能从场景上被移除出去\r\n                if (this.emit) this.emit(NodeEventType.STAGE_CHANGED);// node.stage 可以检测有无舞台\r\n                loopHandler(this, NodeEventType.STAGE_CHANGED);\r\n            }\r\n        }\r\n\r\n        //新增getter/setter:\r\n\r\n        //建议把getter/setter 变量写进 or.d.ts 下的 interface Node 中,便于在使用时带自动提示功能 \r\n        //绕开UIOpacity  直接通过赋值修改Node的opacity(不透明度)\r\n        Object.defineProperty(Node.prototype, \"opacity\", {\r\n            get: function () {\r\n                //没有UIOpacity? 那就自动创建一个\r\n                return this.getOrAddComponent(UIOpacity).opacity;\r\n            },\r\n            set: function (value) {\r\n                //没有UIOpacity? 那就自动创建一个\r\n                this.getOrAddComponent(UIOpacity).opacity = value;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(BaseNode.prototype, \"ww\", {\r\n            get: function () {\r\n                //没有UITransform? 那就自动创建一个\r\n                return this.getOrAddComponent(UITransform).width;\r\n            },\r\n            set: function (value) {\r\n                //没有UITransform? 那就自动创建一个\r\n                this.getOrAddComponent(UITransform).width = value;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n\r\n        Object.defineProperty(Node.prototype, \"hh\", {\r\n            get: function () {\r\n                //没有UITransform? 那就自动创建一个\r\n                return this.getOrAddComponent(UITransform).height;\r\n            },\r\n            set: function (value) {\r\n                //没有UITransform? 那就自动创建一个\r\n                this.getOrAddComponent(UITransform).height = value;\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"x\", {\r\n            get: function () {\r\n                return this.position.x;\r\n            },\r\n            set: function (value) {\r\n                this.setPosition(value, this.position.y, this.position.z);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"y\", {\r\n            get: function () {\r\n                return this.position.y;\r\n            },\r\n            set: function (value) {\r\n                this.setPosition(this.position.x, value, this.position.z);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"z\", {\r\n            get: function () {\r\n                return this.position.z;\r\n            },\r\n            set: function (value) {\r\n                this.setPosition(this.position.x, this.position.y, value);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"scaleX\", {\r\n            get: function () {\r\n                return this.scale.x;\r\n            },\r\n            set: function (value) {\r\n                this.setScale(value, this.scale.y, this.scale.z);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"scaleY\", {\r\n            get: function () {\r\n                return this.scale.y;\r\n            },\r\n            set: function (value) {\r\n                this.setScale(this.scale.x, value, this.scale.z);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n        Object.defineProperty(Node.prototype, \"scaleZ\", {\r\n            get: function () {\r\n                return this.scale.z;\r\n            },\r\n            set: function (value) {\r\n                this.setScale(this.scale.x, this.scale.y, value);\r\n            },\r\n            enumerable: true,\r\n            configurable: true\r\n        });\r\n\r\n    }\r\n}\r\n\r\nengineOverrider.startWrite();\r\n\r\n"]}